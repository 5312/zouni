(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"133e":function(t,e,n){"use strict";(function(t){n("29e1");o(n("66fd"));var e=o(n("c1cc"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"36f2":function(t,e,n){},5728:function(t,e,n){"use strict";var o,i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.isContact=!0})},a=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}))},8447:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){n.e("components/base/auth-login").then(function(){return resolve(n("ea72"))}.bind(null,n)).catch(n.oe)},i={components:{AuthLogin:o},data:function(){return{adImg:"",mapScale:16,isAuthAddress:!1,isShowAuthLogin:!1,phone:0,isContact:!1,weatherInfo:null,latitude:null,longitude:null,covers:[],mapCtx:null,addressInfo:null,fromPage:null}},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:"快来参加吧！",path:"/pages/index/index"}},onLoad:function(t){this.fromPage=t&&t.fromPage?t.fromPage:null,this.fromPage&&"address"===this.fromPage&&(this.addressInfo=JSON.parse(t.addressInfo),this.latitude=this.addressInfo.lat,this.longitude=this.addressInfo.lng,this.$tool.uniSetStorage("addressInfo",this.addressInfo))},onReady:function(){this.init()},methods:{init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$tool.isGetLocation("scope.userLocation",(function(){t.isAuthAddress=!0,t.isShowAuthLogin=!1,t.fromPage&&"address"===t.fromPage&&!e?(t.mapScale=11,t.getWeather(),t.getPthone(),t.getListInfo()):(t.mapScale=16,t.getLocationInfo()),t.getAdInfo()}),(function(){t.isAuthAddress=!1,t.isShowAuthLogin=!0}))},loginOk:function(){this.init()},addressHandle:function(){this.init(!0)},getPthone:function(){var t=this;this.$tool.uniRequest({url:"/api/Tel",success:function(e){t.phone=e.tel}})},markertap:function(t){console.log("markertap",t.detail.markerId);var e=t.detail.markerId,n=null;this.covers.forEach((function(t,o){t.id==e&&(n=t)})),n&&this.getSiteDetail(n)},getSiteDetail:function(t){this.$tool.uniNavigateTo({url:"/pages/index/site-detail?id=".concat(t.goods_id)})},toAdPage:function(){this.$tool.uniNavigateTo({url:"/pages/my/card"})},getLocationInfo:function(){var e=this;this.mapCtx=t.createMapContext("myMap"),t.getLocation({type:"wgs84",geocode:!0,success:function(t){e.latitude=t.latitude,e.longitude=t.longitude,e.$tool.uniRequest({url:"/api/Geocoder",params:{lat:e.latitude,lng:e.longitude},success:function(t){console.log("城市",t);var n=t.geocoder.city;"市"===n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),e.addressInfo={name:n,lat:e.latitude,lng:e.longitude,category_id:""},e.mapCtx.moveToLocation(),e.$tool.uniSetStorage("addressInfo",e.addressInfo),e.getWeather(),e.getListInfo(),e.getPthone()}})}})},getAdInfo:function(){var t=this;this.$tool.uniRequest({url:"/api/Ad",success:function(e){console.log("获取广告地址",e),t.adImg=e.indexAd}})},getWeather:function(){var t=this;this.$tool.uniRequest({url:"/api/weather",isNoCode:!0,params:{lat:this.addressInfo.lat,lng:this.addressInfo.lng,city:this.addressInfo.name},success:function(e){t.weatherInfo=e}})},getListInfo:function(){var t=this;this.$tool.uniRequest({url:"/api/index/",success:function(e){var n=e&&e.posiList&&e.posiList.data?e.posiList.data:[];for(var o in t.covers=[],n){var i={id:o+1,goods_id:n[o].goods_id,latitude:n[o].goods_lat,longitude:n[o].goods_lng,iconPath:"../../static/image/maplocation.png"};t.covers.push(i)}console.log("当前城市标记的站点：",t.covers)}})},scanCode:function(){var e=this;t.scanCode({success:function(t){var n=t.result,o="";if(n&&n.startsWith("https://xi.ydeshui.com")){var i=n;if(i){var a=i.split("?")[1];if(a&&a.length>0){var s=a.split("=");s&&s.length>0&&"siteId"==s[0]&&(o=s[1])}}}o?e.$tool.uniRedirectTo({url:"/pages/scan/index?siteId=".concat(o,"&fromPage=home")}):e.$tool.uniShowToast({title:"目前只支持小程序的扫码支付，不支持其他扫码",icon:"none"})}})},online:function(){this.$tool.uniShowToast({title:"稍后开放！",icon:"none"})},toPage:function(t){var e="";switch(t){case"my":e="/pages/my/index";break;case"vip":e="/pages/my/volume";break;case"address":e="/pages/address/index?addressName=".concat(this.addressInfo.name);break;case"site":e="/pages/index/site";break;default:e="/pages/index/index"}this.$tool.uniNavigateTo({url:e})},call:function(){t.makePhoneCall({phoneNumber:this.phone})},close:function(){this.isContact=!1}}};e.default=i}).call(this,n("543d")["default"])},"98ba":function(t,e,n){"use strict";n.r(e);var o=n("8447"),i=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a},ad53:function(t,e,n){"use strict";var o=n("36f2"),i=n.n(o);i.a},c1cc:function(t,e,n){"use strict";n.r(e);var o=n("5728"),i=n("98ba");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("ad53");var s,u=n("f0c5"),c=Object(u["a"])(i["default"],o["b"],o["c"],!1,null,"75cc945a",null,!1,o["a"],s);e["default"]=c.exports}},[["133e","common/runtime","common/vendor"]]]);