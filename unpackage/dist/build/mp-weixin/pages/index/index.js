(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{1365:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(o("b946"));function i(t){return t&&t.__esModule?t:{default:t}}var a=function(){o.e("components/base/auth-login").then(function(){return resolve(o("055c"))}.bind(null,o)).catch(o.oe)},s={components:{AuthLogin:a},data:function(){return{addpuls:!0,adImg:"",mapScale:16,isAuthAddress:!1,isShowAuthLogin:!1,phone:0,isContact:!1,weatherInfo:null,latitude:null,longitude:null,covers:[],mapCtx:null,addressInfo:null,fromPage:null,markDetail:null,distance:0}},onShareAppMessage:function(t){"button"===t.from&&console.log(t.target);var e=this.$tool.uniGetStorage("userId");return{title:"快来参加吧！",path:"/pages/index/index?referrerId=".concat(e)}},onLoad:function(t){this.fromPage=t&&t.fromPage?t.fromPage:null,this.fromPage&&"address"===this.fromPage&&(this.addressInfo=JSON.parse(t.addressInfo),this.latitude=this.addressInfo.lat,this.longitude=this.addressInfo.lng,this.$tool.uniSetStorage("addressInfo",this.addressInfo)),console.log(t),t.referrerId&&this.$tool.uniSetStorage("referrerId",t.referrerId)},onReady:function(){this.init(),this.findsiteUpdata()},onHide:function(){this.markDetail=null},methods:{init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$tool.isGetLocation("scope.userLocation",(function(){t.isAuthAddress=!0,t.isShowAuthLogin=!1,t.fromPage&&"address"===t.fromPage&&!e?(t.mapScale=11,t.getWeather(),t.getPthone(),t.getListInfo()):(t.mapScale=16,t.getLocationInfo()),t.getAdInfo();var o=t.$tool.uniGetStorage("addressInfo");t.getStorageListSite({latitude:o.lat,longitude:o.lng})}),(function(){t.isAuthAddress=!1,t.isShowAuthLogin=!0}))},loginOk:function(){this.init()},addressHandle:function(){this.init(!0),this.$tool.uniRemoveStorage("site")},getPthone:function(){var t=this;this.$tool.uniRequest({url:"/api/Tel",success:function(e){t.phone=e.tel}})},getPhoneNumber:function(t){if(!t.detail.iv)return this.$tool.uniShowToast({title:"获取失败！"}),!1;this.$tool.uniRequest({url:"",data:{iv:t.detail.iv,encrypted_data:t.detail.encryptedData},success:function(t){console.log(t)}}),console.log(t),console.log(t.detail.iv),console.log(t.detail.encryptedData)},markertap:function(t){var e=this,o=t.detail.markerId,n=null;this.covers.forEach((function(t,i){t.iconPath="../../static/image/maplocation.png",t.id==o&&(n=t,e.markColor(t,i))}));try{if(n.goods_id==this.markDetail.goods_id)return;n&&this.getInfo(n.goods_id)}catch(t){n&&this.getInfo(n.goods_id)}},markColor:function(t,e){t.iconPath="../../static/image/maplocation-on.png"},getInfo:function(t){var e=this,o=this.$tool.uniGetStorage("addressInfo");this.$tool.uniRequest({url:"/api/goods/detail&goods_id=".concat(t),params:{lat:o.lat,lng:o.lng},isNoCode:!0,success:function(t){console.log(t),"Undefined index: result"==t.msg?(e.markDetail=null,setTimeout((function(){e.$tool.uniShowToast({title:"即将开业！",icon:"none"})}),400)):(e.markDetail=t.data.detail,e.distance=t.data.detail.goods_distance?e.$tool.distanceHanlde(t.data.detail.goods_distance):0)}})},regionchange:function(t){t.type},open:function(){t.openLocation({latitude:parseFloat(this.markDetail.goods_lat),longitude:parseFloat(this.markDetail.goods_lng),name:this.markDetail.goods_name,address:this.markDetail.goods_df,success:function(){console.log("success")}})},getSiteDetail:function(){var t=this.markDetail;this.$tool.uniNavigateTo({url:"/pages/index/site-detail?id=".concat(t.goods_id)})},toAdPage:function(){this.$tool.uniNavigateTo({url:"/pages/my/card"})},hideadd:function(){console.log(this.addpuls),this.addpuls=!1},findsiteUpdata:function(){var t=this;this.$tool.uniRequest({url:"/api/index/getconts",params:{wxapp_id:"10001"},success:function(e){if(e){var o=t.$tool.uniGetStorage("covers");if(!o)return;var n=o.length;e.cont!=n&&(console.log(e),t.$tool.uniRemoveStorage("covers"),t.getListInfo())}}})},getLocationInfo:function(){var e=this;this.mapCtx=t.createMapContext("myMap"),t.getLocation({type:"wgs84",geocode:!0,success:function(t){e.latitude=t.latitude,e.longitude=t.longitude,e.$tool.uniRequest({url:"/api/Geocoder",params:{lat:e.latitude,lng:e.longitude},success:function(t){console.log("城市",t);var o=t.geocoder.city;"市"===o.charAt(o.length-1)&&(o=o.substr(0,o.length-1)),e.addressInfo={name:o,lat:e.latitude,lng:e.longitude,category_id:""},e.mapCtx.moveToLocation(),e.$tool.uniSetStorage("addressInfo",e.addressInfo),e.getWeather(),e.getListInfo(),e.getPthone()}})}})},getStorageListSite:function(t){var e=this;this.$tool.uniRemoveStorage("site");var o={lat:String(t.latitude),lng:String(t.longitude)};n.default.GetNearbyGasStation(o).then((function(t){console.log("预请求成功"),e.$tool.uniSetStorage("site",t),getApp().globalData._site=t.posiList[0]}))},getAdInfo:function(){var t=this;n.default.getAdAddress().then((function(e){console.log("获取广告地址",e),t.adImg=e.indexAd}))},getWeather:function(){var t=this,e={lat:this.addressInfo.lat,lng:this.addressInfo.lng,city:this.addressInfo.name};n.default.getWeatherForecast(e).then((function(e){t.weatherInfo=e}))},getListInfo:function(){var t=this,e=this.$tool.uniGetStorage("covers");e?this.covers=e:n.default.mapGetCorver().then((function(e){var o=e&&e.posiList&&e.posiList.data?e.posiList.data:[];for(var n in t.covers=[],o){var i={id:n+1,width:"50rpx",height:"63rpx",goods_id:o[n].goods_id,latitude:o[n].goods_lat,longitude:o[n].goods_lng,iconPath:"../../static/image/maplocation.png"};t.covers.push(i)}t.$tool.uniSetStorage("covers",t.covers),console.log("当前城市标记的站点：",t.covers)}))},scanCode:function(){var e=this,o=new Promise((function(e,o){t.scanCode({success:e})}));o.then((function(t){var o=t.result,n=e.$tool.getUrlParams(o),i=n.siteId?"site":"userSharing",a={site:"/pages/scan/index?siteId=".concat(n.siteId,"&fromPage=home"),userSharing:"/pages/my/card-detail?uid=".concat(n.uid,"&id=").concat(n.tid)};e.$tool.uniRedirectTo({url:a[i]})}))},online:function(){this.$tool.uniShowToast({title:"稍后开放！",icon:"none"})},toPage:function(t){var e={my:"/pages/my/index",vip:"/pages/my/volume",address:"/pages/address/index?addressName=".concat(this.addressInfo.name),site:"/pages/index/site"},o=e[t]||"/pages/index/index";this.$tool.uniNavigateTo({url:o})},call:function(){t.makePhoneCall({phoneNumber:this.phone})},close:function(){this.isContact=!1}}};e.default=s}).call(this,o("543d")["default"])},3562:function(t,e,o){"use strict";var n;o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return n}));var i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.isContact=!0})},a=[]},4970:function(t,e,o){"use strict";o.r(e);var n=o("1365"),i=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,(function(){return n[t]}))}(a);e["default"]=i.a},7768:function(t,e,o){"use strict";var n=o("a7f6"),i=o.n(n);i.a},a7f6:function(t,e,o){},ef7b:function(t,e,o){"use strict";o.r(e);var n=o("3562"),i=o("4970");for(var a in i)"default"!==a&&function(t){o.d(e,t,(function(){return i[t]}))}(a);o("7768");var s,r=o("f0c5"),d=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,"3622bb2b",null,!1,n["a"],s);e["default"]=d.exports},fb41:function(t,e,o){"use strict";(function(t){o("627e");n(o("66fd"));var e=n(o("ef7b"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])}},[["fb41","common/runtime","common/vendor"]]]);