(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/card-detail"],{"07cd":function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=function(){e.e("components/base/auth-login").then(function(){return resolve(e("055c"))}.bind(null,e)).catch(e.oe)},o={components:{AuthLogin:n},data:function(){return{isLogin:!1,isShowAuthLogin:!1,detail:null,isAgreement:!0,suid:null,detailId:null,counts:0,site:null,loading:!1}},onLoad:function(t){var i=t.q?decodeURIComponent(t.q):null;if(i){var e=i.split("?")[1],n=e.split("$");n&&n.length>2&&(this.suid=n[2].split("=")[1],this.detailId=n[3].split("=")[1])}else this.detailId=t.id,this.suid=t.uid;this.init(),this.getDetail()},methods:{init:function(){var t=this;this.$tool.isGetLocation("scope.userInfo",(function(){console.log("logged"),t.logged()}),(function(){console.log("fail"),t.isLogin=!1,t.isShowAuthLogin=!0}))},loginOk:function(){this.logged()},logged:function(){this.getLocationInfo(),this.isLogin=!0,this.isShowAuthLogin=!1},getGlobl:function(){if(this.site=getApp().globalData._site,null!=this.site||this.suid)this.pay();else{this.loading=!0;var t=this.$cache.get("_addressInfo"),i=this;this.getStorageListSite({latitude:t.lat,longitude:t.lng},(function(t){i.loading=!1,i.$cache.set("_site",t),getApp().globalData._site=t.posiList[0],i.site=t.posiList[0],i.pay()}))}},getLocationInfo:function(){var i=this;t.getLocation({type:"wgs84",geocode:!0,success:function(t){i.latitude=t.latitude,i.longitude=t.longitude,i.addressInfo={lat:i.latitude,lng:i.longitude,category_id:""},i.$cache.set("_addressInfo",i.addressInfo)}})},getStorageListSite:function(t,i){this.$cache.delete("_site"),this.$tool.uniRequest({url:"/api/index/page",params:{lat:String(t.latitude),lng:String(t.longitude)},loading:!1,success:i})},strContent:function(t){if(!t||!t.content)return"";var i=this.$tool.htmlre(t.content);return i},getDetail:function(){var t=this;this.$tool.uniRequest({url:"/api/recika/detail",params:{recika_id:this.detailId,suid:this.suid||""},success:function(i){t.detail=i.detail[0],t.counts=i.detail[0].goodscount||0}})},toListPage:function(){this.$tool.uniNavigateTo({url:"/pages/index/site?coupon_id=".concat(this.detail.coupon_id)})},toAgreement:function(){this.$tool.uniNavigateTo({url:"/pages/base/rich?fromPage=serviceAgreement"})},pay:function(){if(this.isAgreement){var t;t=this.suid?{suid:this.suid||"",planId:this.detail.plan_id,customMoney:this.detail.gift_money,dizhi:"",dizhi_id:"",suname:this.detail.suname||""}:{suid:this.suid||"",planId:this.detail.plan_id,customMoney:this.detail.gift_money,dizhi:this.site.goods_name,dizhi_id:this.site.goods_id,suname:this.detail.suname||""},console.log("支付参数",t);var i=this;this.$tool.uniRequest({url:"/api/recika/submit",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},params:t,success:function(t){var e=t.payment;i.$tool.wxPayMoney(e.timeStamp,e.nonceStr,e.prepay_id,"MD5",e.paySign,(function(e){i.$tool.uniShowToast({title:"支付成功！"}),console.log("支付成功",t),setTimeout((function(){i.$tool.uniRedirectTo({url:"/pages/my/volume"})}),1e3)}))}})}else this.$tool.uniShowToast({title:"同意才能支付！",icon:"none"})}}};i.default=o}).call(this,e("543d")["default"])},"0da6":function(t,i,e){},"1e31":function(t,i,e){"use strict";e.r(i);var n=e("07cd"),o=e.n(n);for(var s in n)"default"!==s&&function(t){e.d(i,t,(function(){return n[t]}))}(s);i["default"]=o.a},"556cf":function(t,i,e){"use strict";(function(t){e("627e");n(e("66fd"));var i=n(e("e601"));function n(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("543d")["createPage"])},"6e9e":function(t,i,e){"use strict";var n=e("0da6"),o=e.n(n);o.a},"7f9eb":function(t,i,e){"use strict";e.d(i,"b",(function(){return o})),e.d(i,"c",(function(){return s})),e.d(i,"a",(function(){return n}));var n={uButton:function(){return e.e("uview-ui/components/u-button/u-button").then(e.bind(null,"3e35"))}},o=function(){var t=this,i=t.$createElement,e=(t._self._c,t.isLogin&&t.detail&&t.detail?t.strContent(t.detail):null);t._isMounted||(t.e0=function(i){t.isAgreement=!t.isAgreement},t.e1=function(i){t.isAgreement=!t.isAgreement}),t.$mp.data=Object.assign({},{$root:{m0:e}})},s=[]},e601:function(t,i,e){"use strict";e.r(i);var n=e("7f9eb"),o=e("1e31");for(var s in o)"default"!==s&&function(t){e.d(i,t,(function(){return o[t]}))}(s);e("6e9e");var a,u=e("f0c5"),l=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"281d0205",null,!1,n["a"],a);i["default"]=l.exports}},[["556cf","common/runtime","common/vendor"]]]);