(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/scan/index"],{"0f20":function(o,t,n){},"1a4d":function(o,t,n){"use strict";var e;n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return e}));var i=function(){var o=this,t=o.$createElement;o._self._c},s=[]},"43bd":function(o,t,n){"use strict";n.r(t);var e=n("6d24"),i=n.n(e);for(var s in e)"default"!==s&&function(o){n.d(t,o,(function(){return e[o]}))}(s);t["default"]=i.a},6651:function(o,t,n){"use strict";n.r(t);var e=n("1a4d"),i=n("43bd");for(var s in i)"default"!==s&&function(o){n.d(t,o,(function(){return i[o]}))}(s);n("8eb2");var c,u=n("f0c5"),r=Object(u["a"])(i["default"],e["b"],e["c"],!1,null,"1f08d55e",null,!1,e["a"],c);t["default"]=r.exports},"6d24":function(o,t,n){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=function(){n.e("components/base/auth-login").then(function(){return resolve(n("055c"))}.bind(null,n)).catch(n.oe)},i={components:{AuthLogin:e},data:function(){return{isLogin:!1,isShowAuthLogin:!1,siteId:null,detail:null,carCard:"",price:0,couponList:[],couponInfoPrice:{couponId:0,price:0,name:""}}},onLoad:function(o){console.log("参数",o);var t=o.q?decodeURIComponent(o.q):null,n=o.fromPage;if(t){var e=t.split("?")[1];if(e&&e.length>0){var i=e.split("=");i&&i.length>0&&"siteId"==i[0]&&(this.siteId=i[1],this.init())}}else"addCar"!==n&&"home"!==n||!o.siteId?"select"===n&&o.siteId&&(this.siteId=o.siteId,this.couponInfoPrice.couponId=o.userCouponId,this.init()):(this.siteId=o.siteId,this.init())},computed:{mess:function(){if(this.couponList.length<=0)return"你有".concat(this.couponList.length,"张优惠券可使用");for(var o,t=this.couponInfoPrice.couponId,n=0;n<this.couponList.length;n++){var e=this.couponList[n];e.user_coupon_id==t&&(o=e)}var i="次卡"==o.coupon_type.text?"免费洗车":o.name;return i}},methods:{init:function(){var o=this;this.$tool.isGetLocation("scope.userInfo",(function(){o.logged()}),(function(){o.isLogin=!1,o.isShowAuthLogin=!0}))},loginOk:function(){this.logged()},selectCupon:function(){var o="/pages/scan/select?list=".concat(JSON.stringify(this.couponList),"&userCouponId=").concat(this.couponInfoPrice.couponId,"&siteId=").concat(this.siteId);this.$tool.uniNavigateTo({url:o})},sequence:function(){var o=this.couponList,t=o.length;if(!(t<=0)){for(var n=0;n<t;n++)for(var e=0;e<t-1-n;e++)if(1*o[e].reduce_price<1*o[e+1].reduce_price){var i=o[e+1];o[e+1]=o[e],o[e]=i}this.couponList=o;var s={fromPage:"select",siteId:this.siteId,userCouponId:o[0].user_coupon_id},c=s.fromPage;"select"===c&&s.siteId&&(this.siteId=s.siteId,this.couponInfoPrice.couponId=s.userCouponId,this.init())}},logged:function(){var o=this,t=this;this.$tool.uniRequest({url:"/api/order/buyNow",params:{goods_id:this.siteId,coupon_id:this.couponInfoPrice.couponId,goods_sku_id:"0"},success:function(n){console.log("res",n),n.exist_car?(t.detail=n.goods_list[0],t.couponList=n&&n.coupon_list?n.coupon_list:[],t.carCard=n.car?n.car:"",t.price=n.order_pay_price,t.couponInfoPrice.price=n.coupon_money,t.isLogin=!0,t.isShowAuthLogin=!1,0==n.coupon_money&&t.sequence()):t.$tool.uniRedirectTo({url:"/pages/base/add-car?siteId=".concat(o.siteId,"&pageForm=scan&status=add")})}})},pay:function(){var t=this,n={wxapp_id:"10001",goods_id:this.siteId,coupon_id:this.couponInfoPrice.couponId,pay_type:"20"};console.log("支付参数",n),this.$tool.uniRequest({url:"/api/order/buyNow",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},params:n,success:function(n){if("20"===n.pay_type){var e=n.payment;t.$tool.wxPayMoney(e.timeStamp,e.nonceStr,e.prepay_id,"MD5",e.paySign,(function(e){t.$tool.uniShowToast({title:"支付成功！"}),setTimeout((function(){o.reLaunch({url:"/pages/scan/order-detail?id=".concat(n.order_id)})}),1e3)}))}else"30"===n.pay_type&&(t.$tool.uniShowToast({title:"支付成功！"}),setTimeout((function(){o.reLaunch({url:"/pages/scan/order-detail?id=".concat(n.order_id)})}),1e3))}})}}};t.default=i}).call(this,n("543d")["default"])},8172:function(o,t,n){"use strict";(function(o){n("627e");e(n("66fd"));var t=e(n("6651"));function e(o){return o&&o.__esModule?o:{default:o}}o(t.default)}).call(this,n("543d")["createPage"])},"8eb2":function(o,t,n){"use strict";var e=n("0f20"),i=n.n(e);i.a}},[["8172","common/runtime","common/vendor"]]]);