(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/scan/index"],{"00cd":function(t,n,o){"use strict";o.d(n,"b",(function(){return i})),o.d(n,"c",(function(){return u})),o.d(n,"a",(function(){return e}));var e={uButton:function(){return o.e("uview-ui/components/u-button/u-button").then(o.bind(null,"3e35"))},uModal:function(){return o.e("uview-ui/components/u-modal/u-modal").then(o.bind(null,"d0a6"))}},i=function(){var t=this,n=t.$createElement;t._self._c},u=[]},"43bd":function(t,n,o){"use strict";o.r(n);var e=o("6d24"),i=o.n(e);for(var u in e)"default"!==u&&function(t){o.d(n,t,(function(){return e[t]}))}(u);n["default"]=i.a},6651:function(t,n,o){"use strict";o.r(n);var e=o("00cd"),i=o("43bd");for(var u in i)"default"!==u&&function(t){o.d(n,t,(function(){return i[t]}))}(u);o("c8d5");var c,r=o("f0c5"),s=Object(r["a"])(i["default"],e["b"],e["c"],!1,null,"79024cd9",null,!1,e["a"],c);n["default"]=s.exports},"6d24":function(t,n,o){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=i(o("a34a"));function i(t){return t&&t.__esModule?t:{default:t}}function u(t,n,o,e,i,u,c){try{var r=t[u](c),s=r.value}catch(a){return void o(a)}r.done?n(s):Promise.resolve(s).then(e,i)}function c(t){return function(){var n=this,o=arguments;return new Promise((function(e,i){var c=t.apply(n,o);function r(t){u(c,e,i,r,s,"next",t)}function s(t){u(c,e,i,r,s,"throw",t)}r(void 0)}))}}var r=function(){o.e("components/base/auth-login").then(function(){return resolve(o("055c"))}.bind(null,o)).catch(o.oe)},s={components:{AuthLogin:r},data:function(){return{show:!1,content:null,isLogin:!1,isShowAuthLogin:!1,siteId:null,detail:null,carCard:"",price:0,couponList:[],paytext:"立即支付",disabled:!1,couponInfoPrice:{couponId:0,price:0,name:""}}},onLoad:function(t){console.log("参数",t);var n=t.q?decodeURIComponent(t.q):null,o=t.fromPage;if(n){var e=n.split("?")[1];if(e&&e.length>0){var i=e.split("=");i&&i.length>0&&"siteId"==i[0]&&(this.siteId=i[1],this.init())}}else"addCar"!==o&&"home"!==o||!t.siteId?"select"===o&&t.siteId&&(this.siteId=t.siteId,this.couponInfoPrice.couponId=t.userCouponId,this.init()):(this.siteId=t.siteId,this.init())},computed:{mess:function(){if(this.couponList.length<=0)return"你有".concat(this.couponList.length,"张优惠券可使用");for(var t,n=this.couponInfoPrice.couponId,o=0;o<this.couponList.length;o++){var e=this.couponList[o];e.user_coupon_id==n&&(t=e)}var i="次卡"==t.coupon_type.text?"免费洗车":t.name;return i}},methods:{init:function(){var t=this;this.$tool.isGetLocation("scope.userInfo",(function(){t.logged()}),(function(){t.isLogin=!1,t.isShowAuthLogin=!0}))},loginOk:function(){this.logged()},selectCupon:function(){var t="/pages/scan/select?list=".concat(JSON.stringify(this.couponList),"&userCouponId=").concat(this.couponInfoPrice.couponId,"&siteId=").concat(this.siteId);this.$tool.uniNavigateTo({url:t})},sequence:function(){var t=this.couponList,n=t.length;if(!(n<=0)){for(var o=0;o<n;o++)for(var e=0;e<n-1-o;e++)if(1*t[e].reduce_price<1*t[e+1].reduce_price){var i=t[e+1];t[e+1]=t[e],t[e]=i}this.couponList=t;var u={fromPage:"select",siteId:this.siteId,userCouponId:t[0].user_coupon_id},c=u.fromPage;"select"===c&&u.siteId&&(this.siteId=u.siteId,this.couponInfoPrice.couponId=u.userCouponId,this.init())}},logged:function(){var t=this;return c(e.default.mark((function n(){var o,i;return e.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$api.buyNow({goods_id:t.siteId,coupon_id:t.couponInfoPrice.couponId,goods_sku_id:"0"},"GET");case 2:o=n.sent,i=o.data,""!=i.error_msg&&(console.log(i.error_msg),t.content=i.error_msg,t.show=!0,t.paytext="暂停营业",t.disabled=!0),i.exist_car?(t.detail=i.goods_list[0],t.couponList=i&&i.coupon_list?i.coupon_list:[],t.carCard=i.car?i.car:"",t.price=i.order_pay_price,t.couponInfoPrice.price=i.coupon_money,t.isLogin=!0,t.isShowAuthLogin=!1,0==i.coupon_money&&t.sequence()):t.$tool.uniRedirectTo({url:"/pages/base/add-car?siteId=".concat(t.siteId,"&pageForm=scan&status=add")});case 6:case"end":return n.stop()}}),n)})))()},pay:function(){var n=this;return c(e.default.mark((function o(){var i,u,c,r;return e.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i=n,o.next=3,n.$api.buyNow({wxapp_id:"10001",goods_id:n.siteId,coupon_id:n.couponInfoPrice.couponId,pay_type:"20"},"POST");case 3:if(u=o.sent,0!==u.code){o.next=7;break}return n.$tool.uniShowToast({title:u.msg}),o.abrupt("return");case 7:c=u.data,"20"===c.pay_type?(r=c.payment,n.$tool.wxPayMoney(r.timeStamp,r.nonceStr,r.prepay_id,"MD5",r.paySign,(function(n){i.$tool.uniShowToast({title:"支付成功！"}),setTimeout((function(){t.reLaunch({url:"/pages/scan/order-detail?id=".concat(c.order_id)})}),1e3)}))):"30"===c.pay_type&&(i.$tool.uniShowToast({title:"支付成功！"}),setTimeout((function(){t.reLaunch({url:"/pages/scan/order-detail?id=".concat(c.order_id)})}),1e3));case 9:case"end":return o.stop()}}),o)})))()}}};n.default=s}).call(this,o("543d")["default"])},8172:function(t,n,o){"use strict";(function(t){o("627e");e(o("66fd"));var n=e(o("6651"));function e(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,o("543d")["createPage"])},a914:function(t,n,o){},c8d5:function(t,n,o){"use strict";var e=o("a914"),i=o.n(e);i.a}},[["8172","common/runtime","common/vendor"]]]);